<!-- User dashboard -->
<div class="container pt-3 pb-2">
  <div class="row">
    <div class="col-sm-5">
      <h2><span i18n>Hi</span>, {{currentUser.name}}!</h2>
    </div>
    <div id="home-actions" class="col-sm-7 text-right">
        <!-- Open profile -->
      <button routerLink="{{currentUser.url}}" class="btn btn-outline-primary mr-2" [disabled]="!currentUser.url">
        <fa-icon [icon]="['fas', 'home']" class="mr-1"></fa-icon>
        <span i18n>Open Profile</span>
      </button>

      <!-- Profile settings -->
      <button routerLink="/settings" class="btn btn-outline-primary mr-2">
        <fa-icon [icon]="['fas', 'cog']" class="mr-1"></fa-icon>
        <span i18n>Edit Profile</span>
      </button>

      <!-- Logout -->
      <button (click)="logout()" class="btn btn-outline-primary">
        <span i18n>Logout</span>
      </button>
    </div>
  </div>
</div>

<!-- User banner -->
<div class="bg-user {{currentUser.background != null ? currentUser.background : 'bg-default'}}" *ngIf="!isLoading">
  <div class="container py-4">
    <div class="row">
      <div class="col-xl-8 offset-xl-2 col-lg-11 offset-lg-1 col-md-12 offset-md-0">
        <app-profile *ngIf="currentUser" [user]="currentUser"></app-profile>
      </div>
    </div>
    <div class="row mt-3 justify-content-center" *ngIf="currentUser.certificateProgress < 100 && currentUser.certificateProgress !== null">
        <div class="col-lg-8 col-12">
            <div class="progress certificate-progress">
                <div class="progress-bar progress-bar-striped progress-bar-animated bg-warning" role="progressbar" [ngStyle]="getCertificateProgress()" attr.aria-valuenow="{{currentUser.certificateProgress}}" attr.aria-valuemin="0" attr.aria-valuemax="100">
                    <span>{{100 - currentUser.certificateProgress}} questions left to unlock your certificate</span>
                </div>
            </div>
        </div>
    </div>
  </div>
</div>

<!-- Loader -->
<div class="py-5" *ngIf="isLoading">
    <div class="container py-4">
        <div class="row">
            <div class="col-8 offset-2">
                <div class="page-loader"></div>
            </div>
        </div>
    </div>
</div>

<!-- User tests -->
<div class="container mt-5" *ngIf="!isLoading">
  <div class="row">
    <div class="col-12">
      <h1>{{currentUser.name}}, <span i18n> your iq tests are displayed below</span>.</h1>
    </div>
  </div>

  <section class="row" *ngIf="testTypes && userTests">
      <!-- Test Card -->
    <div class="col-xl-5 offset-xl-1 col-lg-6 offset-lg-0 col-md-6 offset-md-2"
         infiniteScroll
         [infiniteScrollDistance]="2"
         [infiniteScrollUpDistance]="1.5"
         [infiniteScrollThrottle]="50"
         (scrolled)="onScrollDown()"
         *ngFor="let test of userTests">
      <div class="card-container test-{{this.testTypes[this.testTypesKeys[test.type]].styleName}}"
           [ngStyle]="{'background-image': 'url(' + this.testTypes[this.testTypesKeys[test.type]].pic + ')'}"
      >
        <div class="text-white mb-3">
        <!-- Status -->
      <span class="w-25 p-2 badge" [ngClass]="{ 'badge-success': test.status === testStatus.FINISHED,
                         'badge-primary': test.status === testStatus.ACTIVE,
                         'badge-secondary': test.status === testStatus.EXPIRED }">{{test.status}}</span>
        </div>
        <div class="text-white">
          <h1>{{this.testTypes[this.testTypesKeys[test.type]].name}}</h1>
        </div>

        <!-- Points -->
        <div class="badge iq-badge-test test-megaiq position-absolute"
             *ngIf="test.type == testTypeEnum.MEGA_IQ">{{test.points}}</div>
        <div class="badge iq-badge-test test-standard position-absolute"
             *ngIf="test.type == testTypeEnum.STANDARD_IQ">{{test.points}}</div>

        <!-- Options -->
        <div class="row">
          <div class="col-sm-6 col-12" *ngIf="test.status === testStatus.FINISHED">
            <a routerLink="{{test.url}}" class="btn btn-success btn-block btn-lg mt-2">
              <fa-icon [icon]="['fas', 'share']" class="mr-1"></fa-icon>
              <span i18n>Open Details</span></a>
          </div>

          <div class="col-sm-6 col-12">
            <button routerLink="/classroom/{{test.code}}" class="btn btn-warning btn-block btn-lg mt-2"
                    *ngIf="test.status === testStatus.FINISHED" [disabled]="loading && test.code === deletedId">
              <fa-icon [icon]="['fas', 'sun']" class="mr-1"></fa-icon>
              <span i18n>Show Answers</span></button>
          </div>
        </div>

        <!-- Details -->
        <div *ngIf="!test.finishDate" class="course-progress">
          <div class="text-white test-progress">
            <span i18n>Overall test progress</span>: {{test.progress}}%
            <progress class="w-100" value="{{test.progress}}" max="100" role="progressbar"></progress>
          </div>
        </div>
        <div class="course-starts text-white pt-2">
          <span i18n>Started at</span>: {{test.createDate | date:'medium'}}
        </div>
        <div class="course-ends text-white" *ngIf="test.finishDate">
          <span i18n>Finished at</span>: {{test.finishDate | date:'medium'}}
        </div>
        <!-- Test actions -->
        <div class="row">
          <div class="col-12">
            <button routerLink="/classroom/{{test.code}}" class="btn btn-primary btn-block btn-lg mt-3"
                    *ngIf="test.status === testStatus.ACTIVE" i18n>Continue Test
            </button>
          </div>
        </div>

        <div class="text-right">
          <button class="w-100 btn btn-danger btn-lg mt-3" (click)="deleteTestResult(test.code)"
                  *ngIf="test.status !== testStatus.ACTIVE" [disabled]="loading && test.code === deletedId">
            <span *ngIf="!loading"><fa-icon [icon]="['fas', 'trash']" class="mr-1"></fa-icon><span i18n>Delete</span></span>
            <span *ngIf="loading" class="actn-loader"></span>
          </button>
        </div>
      </div>
    </div>
  </section>

  <div class="row" *ngIf="isLastLoaded">
    <div class="col-8 offset-2">
      <div class="alert alert-info" i18n>All results were loaded successfully.</div>
    </div>
  </div>
</div>
