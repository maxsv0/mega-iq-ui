<div class="container pt-3" *ngIf="activeTest">
  <div class="row">
    <div class="col-md-8">
      <div class="jumbotron py-5">
        <div>
          <h3><span class="text-muted mr-3"><span
            i18n>Question</span> #{{activeQuestionId}}</span>{{activeQuestion.title}}</h3>
          <div class="text-center my-3">
            <img *ngIf="!updating" src="{{activeQuestion.pic}}" srcset="{{activeQuestion.pic2x}} 2x" width="470"
                 height="370">
            <div *ngIf="updating" class="page-loader position-relative mt-6"></div>
          </div>
          <div class="container card my-3">
            <div *ngIf="!updating" class="row text-center">
              <div class="col-md-2 col-sm-3 px-0 py-2" *ngFor="let answer of activeQuestion.answers"
                   [ngClass]="{'answer': activeTest.status === testStatus.ACTIVE, 'answer-active': answer.id === activeQuestion.answerUser, 'answer-correct': answer.id === activeQuestion.answerCorrect}">
                <div (click)="submitAnswer(activeTest.code, activeQuestionId, answer.id)"
                     *ngIf="activeTest.status === testStatus.ACTIVE" class="btn px-0">
                  <img src="{{answer.pic}}" srcset="{{answer.pic2x}} 2x" width="92" height="92">
                </div>
                <div *ngIf="activeTest.status === testStatus.FINISHED">
                  <img src="{{answer.pic}}" srcset="{{answer.pic2x}} 2x" width="92" height="92">
                </div>
              </div>
            </div>
          </div>
          <div class="container">
            <div class="row" *ngIf="activeTest.status === testStatus.ACTIVE">
              <div class="col-6">
                <p class="text-muted small" i18n>Click to submit the answer</p>
              </div>
              <div class="col-6 text-right">
              <span *ngIf="loading" class="submit-answer position-relative">
				  	<span class="px-4 text-muted small" i18n>Submitting your answer, please wait</span>
					<span class="actn-loader text-muted"></span>
              </span>
                <span class="badge badge-success"
                      *ngIf="activeTest.status === testStatus.ACTIVE && activeQuestion.answerUser"
                      i18n>Answer submitted</span>
              </div>
            </div>

            <div class="row">
              <div class="col-sm-6">
                <div class="btn btn-link" (click)="setQuestion(activeQuestionIdPrev)"
                     [ngClass]="{'disabled': activeQuestionIdPrev === 0}" [class.disabled]="updating">
                  <fa-icon [icon]="['fas', 'chevron-left']" class="mr-1"></fa-icon>
                  <span i18n>Previous Question</span>
                </div>
              </div>
              <div class="col-sm-6 text-right">
                <div class="btn btn-link" (click)="setQuestion(activeQuestionIdNext)"
                     [ngClass]="{'disabled': activeQuestionIdNext === 0}" [class.disabled]="updating">
                  <span i18n>Next Question</span>
                  <fa-icon [icon]="['fas', 'chevron-right']" class="ml-1"></fa-icon>
                </div>
              </div>
              <div class="col-sm-12 card mt-3" *ngIf="activeQuestion.description">
                <p class="my-3">
                  <fa-icon [icon]="['fas', 'question']" class="mr-1"></fa-icon>
                  {{activeQuestion.description}}
                </p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="col-md-4">
      <div class="jumbotron py-5">
        <h4>{{activeTestName}}
          <span class="badge"
                [ngClass]="{ 'badge-success': activeTest.status === testStatus.FINISHED, 'badge-primary': activeTest.status === testStatus.ACTIVE, 'badge-secondary': activeTest.status === testStatus.EXPIRED}">{{activeTest.status}}</span>
        </h4>
        <div class="text-muted test-progress">
          <p i18n>Current test progress</p>
          <progress class="w-100" value="{{activeTest.progress}}" max="100" role="progressbar"></progress>
        </div>
        <p>
          <span i18n>Started</span>: {{activeTest.createDate | date:'medium'}}
        </p>
        <p *ngIf="activeTest.points">
          <span i18n>Result</span>: {{activeTest.points}}
        </p>
        <p *ngIf="!activeTest.finishDate">
          <button class="btn btn-primary btn-block" (click)="submitFinish(activeTest.code)" [disabled]="loading">
            <fa-icon *ngIf="!loading" [icon]="['fas', 'x-ray']" class="mr-1"></fa-icon>
            <span *ngIf="!loading" i18n>Submit test</span>
            <span *ngIf="loading" class="actn-loader"></span>
          </button>
        </p>
        <div *ngIf="activeTest.finishDate" class="text-muted">
          <h4>
            <fa-icon [icon]="['fas', 'check']" class="mr-1"></fa-icon>
            <span i18n>Test finished</span>
          </h4>
          <h4 class="text-info">
            {{activeTest.finishDate | date:'medium'}}
          </h4>
        </div>
      </div>

      <div class="jumbotron py-5">
        <p class="text-muted" i18n>Click to navigate questions</p>
        <p>
        <span class="btn" *ngFor="let question of activeTest.questionSet; index as index"
              (click)="setQuestion(index + 1)"
              [ngClass]="{ 'm-2 set-question rounded-circle': question, 'set-question-active': index === activeQuestionId - 1, 'set-question-answered': question.answerUser }"
        >{{index + 1}}</span>
        </p>
      </div>

      <button class="btn btn-info btn-block" (click)="submitAllRandom(activeTest.code)" [disabled]="loading">
        <fa-icon *ngIf="!loading" [icon]="['fas', 'x-ray']" class="mr-1"></fa-icon>
        <span *ngIf="!loading">Submit ALL</span>
        <span *ngIf="loading" class="actn-loader"></span>
      </button>
    </div>
  </div>
</div>

<div class="container" *ngIf="!activeTest">
  <div class="row">
    <div class="col">
      <div class="jumbotron loader-placeholder">
        <div class="page-loader"></div>
      </div>
    </div>
  </div>
</div>
